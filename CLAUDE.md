# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Brazilian public procurement system (Sistema de Licitações) built with Laravel 12 and React 19 using Inertia.js. The system manages the complete procurement lifecycle including suppliers, contracts, purchase orders, requisitions, and audit conferences for public sector organizations.

## Development Commands

### Backend (Laravel/PHP)
```bash
# Development server
php artisan serve

# Database operations
php artisan migrate                    # Run migrations
php artisan migrate:fresh --seed     # Fresh migration with seeds
php artisan db:seed                   # Seed database with sample data

# Queue management
php artisan queue:work                # Start queue worker
php artisan queue:listen              # Listen for queue jobs

# Testing
composer run test                     # Run all PHP tests with Pest
php artisan test --filter TestName    # Run specific test

# Code quality
php artisan pail                      # Advanced logging system
composer run lint:check              # Check code style with Laravel Pint
```

### Frontend (React/TypeScript)
```bash
# Development
npm run dev                          # Start Vite dev server
npm run build                        # Production build
npm run build:ssr                    # Build with SSR

# Code quality
npm run lint                         # Biome linting with auto-fix
npm run format                       # Biome formatting
npm run types                        # TypeScript type checking
npm run check                        # Run all Biome checks
```

### Full Stack Development
```bash
# Start all services (recommended for local development)
composer run dev                     # Starts Laravel server, queue worker, logs, and Vite

# Development with SSR
composer run dev:ssr                 # Includes Inertia SSR server

# Wayfinder (TypeScript bindings generation)
php artisan wayfinder:generate --with-form  # Generate TypeScript bindings for Laravel controllers
```

### Docker
```bash
docker-compose up -d                 # Start all containers
docker-compose exec app php artisan migrate    # Run migrations in container
docker-compose logs -f app           # View application logs
```

## Architecture Overview

### Backend Architecture (Laravel)
- **MVC Pattern**: Controllers handle HTTP requests, Models manage data, Views are React components via Inertia.js
- **Role-Based Access Control**: Middleware-based authorization with `user.type` (operacional, gestor, admin)
- **Resource Controllers**: Standard CRUD operations using Laravel's resource routing
- **Form Request Validation**: Separate request classes for input validation
- **Queues**: Asynchronous processing for background tasks (exports, notifications)
- **Laravel Wayfinder**: Automatic TypeScript bindings generation for type-safe frontend calls

### Frontend Architecture (React + Inertia.js)
- **Page Components**: Located in `resources/js/pages/` - one component per route
- **Shared Components**: Reusable UI components in `resources/js/components/ui/`
- **Layouts**: Page layouts in `resources/js/layouts/`
- **Type Safety**: TypeScript bindings generated by Laravel Wayfinder in
- **shadcn/ui** for accessible UI primitives
- **Icons**: Lucide icons integrated via `lucide-react`
- **Flowbite** for component scaffolding
`resources/js/actions/`
- **State Management**: Inertia.js forms with `@inertiajs/react` and `react-hook-form`
- **Styling**: Tailwind CSS with custom component variants using `class-variance-authority`
- 


### Key Design Patterns

#### Wayfinder Integration
The system uses Laravel Wayfinder to generate type-safe bindings:
- Controller methods are automatically available as imported functions in TypeScript
- Form helpers provide `resetOnSuccess` and other form configuration
- Routes are type-safe and auto-completed in IDEs

Example:
```typescript
import FornecedorController from '@/actions/App/Http/Controllers/FornecedorController';

// Type-safe controller method calls
<FornecedorController.store.form resetOnSuccess={['name']}>
  {/* form fields automatically typed */}
</FornecedorController.store.form>
```

#### Component Structure
- **Pages**: Route components in `resources/js/pages/[ModuleName]/`
- **Index Pages**: List views with filtering, pagination, and bulk actions
- **Create/Edit Pages**: Form pages with validation and dynamic item management
- **Show Pages**: Detail views with related data and action buttons

#### Data Flow
1. **Frontend**: User interactions trigger Inertia.js requests
2. **Backend**: Controllers validate, process, and return data as props
3. **Frontend**: React components receive typed props and render UI
4. **Forms**: Use Inertia forms with automatic loading states and error handling

### Module Structure

Each functional module follows this pattern:
```
resources/js/pages/[ModuleName]/
├── Index.tsx          # List view with filters/pagination
├── Create.tsx         # Create form with dynamic items
├── Show.tsx           # Detail view with actions
└── Edit.tsx           # Edit form with data pre-population
```

Backend models correspond 1:1 with frontend interfaces in `resources/js/types/index.d.ts`.

## Key Implementation Details

### Purchase Order System (Task 3 Implementation)
The system implements a complete purchase order workflow:
- **Secretaria-based requests**: Each department can create purchase orders
- **Authorization workflow**: Purchase managers approve/reject requests
- **Dynamic item management**: Add/remove items with real-time calculations
- **Status tracking**: Draft → Pending Approval → Approved/Rejected → Execution

### Contract Management
- **Multi-item contracts**: Support for contracts with multiple items and specifications
- **Expiration tracking**: Automatic status updates for expired contracts
- **Usage limits**: Track request and conference limits against contract terms
- **Audit trail**: Complete history of contract modifications

### Authentication & Authorization
- **Middleware protection**: Routes protected by `auth` and `user.type` middleware
- **Role-based features**: Different UI components and actions based on user roles
- **Session management**: Laravel's built-in session handling with Inertia.js

## Database Patterns

### Migration Strategy
- **Descriptive migrations**: Clear table and column names in Portuguese (business domain)
- **Foreign key constraints**: Proper relationships with cascade deletes where appropriate
- **Indexing**: Strategic indexes for performance on frequently queried columns

### Model Relationships
- **Eloquent relationships**: BelongsTo, HasMany, BelongsToMany as appropriate
- **Computed attributes**: Model accessors for formatted display values
- **Business logic methods**: Model methods for business operations (podeEditar(), podeAprovar(), etc.)

## Testing Strategy

### PHP Testing (Pest)
```bash
# Run all tests
composer run test

# Run specific test file
php artisan tests tests/Feature/FornecedorTest.php

# Run with coverage
php artisan --coverage
```

### Frontend Testing
- Component testing setup with TypeScript support
- Integration tests for form submissions and data flows
- End-to-end tests for complete user workflows

## Development Guidelines

### Code Style
- **PHP**: Follow PSR-12, use Laravel Pint for formatting
- **TypeScript**: Use Biome for linting and formatting
- **Components**: Use Radix UI primitives with Tailwind CSS styling
- **Forms**: Implement proper validation on both frontend and backend

### Performance Considerations
- **Pagination**: Use Laravel's pagination for large datasets
- **Lazy loading**: Load relationships only when needed
- **Optimistic UI**: Update UI immediately, rollback on errors
- **Queue processing**: Heavy operations (exports, PDFs) use background queues

### Security
- **Input validation**: Never trust client-side validation alone
- **CSRF protection**: All forms include CSRF tokens
- **Authorization checks**: Verify user permissions for all actions
- **SQL injection prevention**: Use Eloquent ORM and parameterized queries

## Important Notes

### Portuguese Business Domain
The system uses Portuguese terminology reflecting Brazilian public procurement regulations:
- **Secretaria**: Department/Secretariat (government entity)
- **Contrato**: Contract with suppliers
- **Licitação**: Public bidding process
- **Fornecedor**: Supplier/Vendor
- **Requisição**: Purchase request/requisition

### Wayfinder Regeneration
After adding new controller methods or changing signatures:
```bash
php artisan wayfinder:generate --with-form
```

This ensures TypeScript bindings are up-to-date and type-safe.

### Asset Management
- **Development**: Vite dev server serves assets automatically
- **Production**: Build assets with `npm run build` before deployment
- **Versioning**: Assets are automatically versioned by Laravel Mix/Vite

### Environment Configuration
- **Local**: Use SQLite database (`DB_CONNECTION=sqlite`)
- **Production**: Configure MySQL/PostgreSQL with proper credentials
- **Docker**: Use provided docker-compose.yml for consistent environments

### Finally
- Do **NOT** generate markdown files at end of responses. This makes the code base hard to read.
- Try to search for the user content before implementing, this could result in less code generation and more context aware responses.
